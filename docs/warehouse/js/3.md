# ç»å…¸å®ç° - å‡½æ•°ç›¸å…³

> è¿™é‡Œè®°å½•äº†é«˜é¢‘çš„å‡½æ•°å®ç°
> æ¯ä¸ªå®ç°æ²¡æœ‰éš¾æ˜“ä¹‹åˆ†ï¼Œäº†è§£å…¶èƒŒåçš„åŸç†æ‰æ˜¯æœ€é‡è¦çš„

<!-- ç®€æ˜“é”šç‚¹ï¼Œidéœ€è¦ä½¿ç”¨è‹±æ–‡åç§° -->

## ç›®å½• 

* <a href="#call">call</a>
* <a href="#bind">bind</a>
* <a href="#apply">apply</a>
* <a href="#equals">ä¸¤ä¸ªå€¼ç›¸ç­‰</a>
* <a href="#compose">composeå‡½æ•°</a>
* <a href="#pipe">ç®¡é“å‡½æ•°</a>
* <a href="#fibonacci">æ–æ³¢é‚£å¥‘</a>
* <a href="#debounce">é˜²æŠ–</a>
* <a href="#throttle">èŠ‚æµ</a>
* <a href="#sleep">sleepç¡çœ å‡½æ•°</a>

## å‡½æ•°

<h3 id="bind">bind</h3>

**æè¿°**

> bind() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨`bind()`è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–°å‡½æ•°çš„`this`è¢«æŒ‡å®šä¸º`bind()`çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œå…¶ä½™å‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„å‚æ•°ï¼Œä¾›è°ƒç”¨æ—¶ä½¿ç”¨ã€‚

```js
// by ä½™å…‰
Function.prototype._bind = function(context, ...arg) {
  var self = this;
  const fBound = function(...childArg) {
    return self.apply(context, arg.concat(childArg)); // æ‹¼æ¥å‚æ•°
  };
  fBound.prototype = this.prototype; // è¿æ¥åŸå‹é“¾
  return fBound;
};
//zy
Function.prototype.myBind = function(context = window, ...args) {
  const fn = this;
  let newFn = function(...secondArgs) {
    fn.call(this, ...args, ...secondArgs);
  };
  newFn.prototype = this.prototype;
  return newFn;
};
```

<h3 id="call">call</h3>

ä½¿ç”¨ä¸€ä¸ªæŒ‡å®šçš„ this å€¼å’Œå•ç‹¬ç»™å‡ºçš„ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°æ¥è°ƒç”¨ä¸€ä¸ªå‡½æ•°

> ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šäº†å‡½æ•°ä½“å†… this å¯¹è±¡çš„æŒ‡å‘
> ç¬¬äºŒä¸ªå‚æ•°åŠä»¥åä¸ºå‡½æ•°è°ƒç”¨çš„å‚æ•°

```js
// ä½™å…‰
Function.prototype._bind = function(obj, ...arg) {
  if (typeof this !== "function") {
    throw new Error("what is trying to be bound is not callable");
  }
  const obj = obj || window; // å¯ä»¥åœ¨å‚æ•°ä¸Šè®¾ç½®é»˜è®¤å€¼
  obj.func = this; // è¿™é‡Œæ¨èä½¿ç”¨Symbol

  const result = obj.func(...arg); // æ‰§è¡Œå‡½æ•°
  delete obj.func; // åˆ é™¤å‡½æ•°ï¼Œå½“åšä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿï½
  return result;
};
//zy
Function.prototype.myCall = function(context = window, ...args) {
  const key = Symbol(); // é˜²æ­¢è¦†ç›–åŸæœ‰å±æ€§
  context[key] = this;
  const result = context[key](...args);
  delete context[key];
  return result;
};
```

- Symbol å¯ä»¥é˜²æ­¢è¦†ç›–åŸæœ‰å±æ€§ ğŸ‘


<h3 id="apply">apply</h3>

> ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šäº†å‡½æ•°ä½“å†… this å¯¹è±¡çš„æŒ‡å‘
> ç¬¬äºŒä¸ªå‚æ•°ä¸ºå‡½æ•°è°ƒç”¨çš„å‚æ•°æ•°ç»„

```js
// ä½™å…‰
Function.prototype._bind = function(obj = window, arg) {
  const key = Symbol();
  obj[key] = this; // å°†å‡½æ•°å˜æˆå¯¹è±¡çš„å†…éƒ¨å±æ€§
  const result = obj[key](...arg); // æ‰§è¡Œå‡½æ•°
  delete obj[key]; // åˆ é™¤å‡½æ•°ï¼Œå½“åšä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿï½
  return result;
};

//zy
Function.prototype.myApply = function(context = window, args) {
  const key = Symbol(); // é˜²æ­¢è¦†ç›–åŸæœ‰å±æ€§
  context[key] = this;
  const result = context[key](...args);
  delete context[key];
  return result;
};
```


<h3 id="equals">åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰</h3>

- å¦‚æœæ˜¯åŸºæœ¬ç±»å‹ï¼Œåˆ™ç›´æ¥åˆ¤æ–­
- å¦‚æœæ˜¯ Date ç±»å‹ï¼Œåˆ™æ¯”è¾ƒæ—¶é—´æˆ³
- åˆ¤æ–­æ˜¯å¦æ˜¯ null æˆ–è€… undefined
- å¦‚æœæ˜¯å¼•ç”¨ç±»å‹åˆ™é€’å½’æ¯”è¾ƒæ¯ä¸€ä¸ªå±‚çº§çš„å€¼æ˜¯å¦ç›¸ç­‰

```js
function equals(a, b) {
  // åŸºæœ¬ç±»å‹ã€nullã€undefined
  if (a === b) return true;
  // Date
  if (a instanceof Date && b instanceof Date) {
    return a.getTime() === b.getTime();
  }
  // ç©º æˆ– null
  if (!a || !b || (typeof a !== "object" && typeof b !== "object")) {
    return a === b;
  }
  const keysA = Object.keys(a);
  const keysB = Object.keys(b);
  // å±æ€§æ•°é‡ä¸ä¸€è‡´
  if (keysA.length !== keysB.length) return false;
  return keysA.every((key) => equals(a[key], b[key]));
}
```


<h3 id="compose">composeå‡½æ•°</h3>

- å¤åˆå‡½æ•°
- ä»–æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­ä½¿ç”¨è¾ƒå¤šçš„ä¸€ç§å†™æ³•, é€šè¿‡ compose çš„æ–¹å¼ç»„åˆå‡½æ•°, å°†å¤–éƒ¨æ•°æ®ä¾æ¬¡é€šè¿‡å„ä¸ªå‡½æ•°çš„åŠ å·¥ï¼Œç”Ÿæˆç»“æœã€‚
- é¡ºåºæ˜¯ä»å³åˆ°å·¦

```js
function compose(...arg) {
  // ä¿å­˜å‚æ•°åˆ—è¡¨
  // æŒ‰å€’å™æ‰§è¡Œå¹¶è¿”å›ç»“æœä½œä¸ºä¸‹ä¸€æ¬¡çš„å‚æ•°
  return function(x) {
    return arg.reduceRight((p, f) => f(p), x);
  };
}

const add = (x) => x + x;
const mul = (x) => x * x;
const one = (x) => x + 1;

const newFunc = compose(add, mul, one);
console.log(newFunc(2)); // 18
```


<h3 id="pipe">pipeå‡½æ•°</h3>

- ä»å·¦è‡³å³ï¼Œå‡½æ•°æ“ä½œçš„ç»“æœä¾æ¬¡ä¸ºä¸‹ä¸€ä¸ªå‡½æ•°çš„å‚æ•°
- pipe(a,b,c) = (...args) => c(b(a(...args)));
- å’Œ compose å‚æ•°ä¼ é€’é¡ºåºç›¸å

```js
function Pipe(...funcs) {
  return function(arg) {
    return funcs.reduce((arg, func) => func(arg), arg);
  };
}
```


<h3 id="fibonacci">æ–æ³¢é‚£å¥‘æ•°åˆ—</h3>

- æœ€ç»å…¸çš„é—®é¢˜ï¼ŒæŒ‡çš„æ˜¯è¿™æ ·ä¸€ä¸ªæ•°åˆ—ï¼š1ã€1ã€2ã€3ã€5ã€8ã€13ã€21
- æ–æ³¢é‚£å¥‘æ•°åˆ—ä»¥å¦‚ä¸‹è¢«ä»¥é€’å½’çš„æ–¹æ³•å®šä¹‰ï¼šF0=0ï¼ŒF1=1ï¼ŒFn=Fn-1+Fn-2ï¼ˆn>=2ï¼ŒnâˆˆN\*ï¼‰
- ç”¨æ–‡å­—æ¥è¯´ï¼Œå°±æ˜¯æ–æ³¢é‚£å¥‘æ•°åˆ—ç”± 0 å’Œ 1 å¼€å§‹ï¼Œä¹‹åçš„æ–æ³¢é‚£å¥‘æ•°åˆ—ç³»æ•°å°±ç”±ä¹‹å‰çš„ä¸¤æ•°ç›¸åŠ ã€‚

```js
// é€’å½’
function fibonacci(n) {
  // è¾¹ç•Œ
  if (n <= 0) return 0;

  return n <= 2 ? 1 : fibonacci(n - 2) + fibonacci(n - 1);
}

// åŠ¨æ€è§„åˆ’ - ä¿å­˜ç»“æœ
function fibonacci(n) {
  // è¾¹ç•Œ
  if (n <= 0) return 0;
  if (n === 1 || n === 2) return 1;
  // å¾ªç¯
  const res = [1, 1];
  for (let i = 2; i < n; i++) {
    const cur = res[i - 2] + res[i - 1];
    res.push(cur);
  }
  return res[n - 1];
}

// åŠ¨æ€è§„åˆ’ - æ»šåŠ¨æ•°ç»„
function fibonacci(n) {
  // è¾¹ç•Œ
  if (n <= 0) return 0;
  if (n === 1 || n === 2) return 1;
  // å¾ªç¯
  let p = 0,
    q = 0,
    r = 1;
  for (let i = 2; i <= n; i++) {
    p = q;
    q = r;
    r = p + q;
    console.log(">>>:", p, q, r);
  }
  return r;
}
```

å¯ä»¥çœ‹çœ‹è¿˜æœ‰æ²¡æœ‰æ›´ä¼˜é›…çš„æ–¹æ³•ï¼Ÿ


<h3 id="debounce">é˜²æŠ–</h3>

- åœ¨ä¸€ä¸ªåŠ¨ä½œå‘ç”Ÿä¸€å®šæ—¶é—´å†…è¿ç»­è§¦å‘ï¼Œåªåœ¨æœ€åä¸å†è§¦å‘åæ‰§è¡Œäº‹ä»¶

```js
// by ä½™å…‰
function debounce(fn, dely) {
  let timer = null;
  return function() {
    // é‡å¤è§¦å‘ï¼Œæ¸…é™¤å®šæ—¶å™¨
    clearTimeout(timer);
    // ä¿®æ­£thisæŒ‡å‘
    timer = setTimeout(() => fn.apply(this, arguments), dely);
  };
}
// by zy
function myDebounce(fn,delay){
    let timer = null;
    return function(...args){
        if(timer){
            clearTimeout(timer)
        }
        timer = setTimeout(() => {fn.call(this,...args)},delay);
    }
}
```


<h3 id="throttle">èŠ‚æµ</h3>

- å½“æŒç»­è§¦å‘å‡½æ•°æ—¶ï¼ŒèŠ‚æµå‡½æ•°ä¼šå¸®åŠ©ä½ ä¸€æ®µæ—¶é—´é—´éš”å†…æ‰§è¡Œ 1 æ¬¡å‡½æ•°

```js
// by ä½™å…‰
// æ—¶é—´æˆ³ç‰ˆ
function throttle(fn, wait) {
  let last = 0;
  return function() {
    let cur = Date.now();
    if (cur - last > wait) {
      fn.apply(this, arguments);
      last = cur;
    }
  };
}

// å®šæ—¶å™¨ç‰ˆ
function throttle(fn, wait) {
  let flag = true;
  return function() {
    if (!flag) return;
    flag = false;
    setTimeout(() => {
      fn.apply(this, arguments);
      flag = true;
    }, wait);
  };
}

// by zy
function myThrottle(fn, delay) {
    let timer = null;
    return function (...args) {
        if (timer) return false;
        timer = setTimeout(() => {
            fn.call(this,...args);
            timer = null;
        },delay)
    }
}
```


<h3 id="sleep">sleepç¡çœ å‡½æ•°</h3>

**å±±å¯¨ç‰ˆ**

```js
// settimeout å¹¶ä¸ä¼šå®Œç¾çš„sleep
function sleep(callback, wait) {
  setTimeout(callback, wait);
}

console.log("1");
sleep(() => {
  console.log("ç»“æŸæ²‰ç¡");
}, 3000);
console.log("2");

// 1
// 2
// ç»“æŸæ²‰ç¡
```

ä½ ä¼šå‘ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªå»¶æ—¶å‡½æ•°ï¼Œä½†å¹¶ä¸å½±å“å…¶ä»–åŒæ­¥ä»»åŠ¡çš„æ‰§è¡Œ

**ä¼˜é›…ç‰ˆï¼š**

```js
function sleep(wait) {
    return new Promise((resolve) => setTimeout(resolve, wait));
}

async function test() {
    console.log('1');
    await sleep(3000);
    console.log('2');
}
test(); 
```

---

